#### åŸæ–‡é“¾æ¥ï¼š[JavaåŸºç¡€é¢è¯•16é—®](https://mp.weixin.qq.com/s/-xFSHf7Gz3FUcafTJUIGWQ)

## è¯´è¯´è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ

è¿›ç¨‹æ˜¯**ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œ**ï¼Œæ˜¯**ç³»ç»Ÿèµ„æºåˆ†é…ä¸è°ƒåŠ¨çš„åŸºæœ¬å•ä½**ï¼Œä½¿ç¨‹åºèƒ½å¤Ÿ**å¹¶å‘æ‰§è¡Œ**

å› ä¸ºè¿›ç¨‹çš„åˆ›å»ºã€é”€æ¯ã€åˆ‡æ¢äº§ç”Ÿå¤§é‡çš„æ—¶é—´å’Œç©ºé—´å¼€é”€ï¼Œè¿›ç¨‹çš„æ•°é‡ä¸èƒ½å¤ªå¤šï¼Œçº¿ç¨‹æ˜¯æ¯”**è¿›ç¨‹æ›´å°çš„èƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½ï¼Œæ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå®ä½“**

çº¿ç¨‹åŸºæœ¬å ç”¨ç³»ç»Ÿèµ„æºï¼Œåªè¿è¡Œå¿…ä¸å¯å°‘çš„èµ„æºï¼ˆç¨‹åºè®¡æ•°å™¨ï¼Œå¯„å­˜å™¨ï¼Œæ ˆï¼‰

è¿›ç¨‹å ç”¨å †ã€æ ˆ



## çŸ¥é“synchronizedåŸç†å—ï¼Ÿ

javaæä¾›çš„**åŸå­æ€§å†…ç½®é”ğŸ”’**ï¼Œå†…ç½®çš„ä½¿ç”¨è€…çœ‹ä¸åˆ°çš„é”ç§°ä¸º**ç›‘è§†å™¨é”**ï¼Œä½¿ç”¨synchronizedä¹‹åï¼Œä¼šåœ¨ç¼–è¯‘ä¹‹ååœ¨åŒæ­¥çš„ä»£ç å—å‰ååŠ ä¸Š`monitorenter`å’Œ

`monitorexit`å­—èŠ‚ç æŒ‡ä»¤,å®ƒä¾èµ–æ“ä½œç³»ç»Ÿåº•å±‚äº’æ–¥é”å®ç°ã€‚å®ƒçš„ä½œç”¨ä¸»è¦æ˜¯å®ç°åŸå­æ€§æ“ä½œå’Œè§£å†³å…±äº«å˜é‡çš„å†…å­˜å¯è§æ€§é—®é¢˜ã€‚

æ‰§è¡Œ`monitorenter`æŒ‡ä»¤æ—¶ä¼š**å°è¯•è·å–å¯¹è±¡é”**ï¼Œå¦‚æœ**å¯¹è±¡æ²¡æœ‰è¢«é”å®šæˆ–è€…å·²ç»è·å¾—äº†é”**ï¼Œ<u>é”çš„è®¡æ•°å™¨+1</u>.æ­¤æ—¶å…¶ä»–ç«äº‰é”çš„çº¿ç¨‹ä¼š**è¿›å…¥ç­‰å¾…é˜Ÿåˆ—**ä¸­ã€‚

æ‰§è¡Œ`monitorexit`æŒ‡ä»¤æ—¶ä¼šæŠŠ<u>è®¡æ•°å™¨-1</u>ï¼Œå½“è®¡æ•°å™¨ä¸º0æ—¶ï¼Œé”é‡Šæ”¾ï¼Œå¤„äºç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å†ç»§ç»­ç«äº‰é”ã€‚

synchronizedæ˜¯æ’å®ƒé”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å¾—é”ä¹‹åï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å¾…è¯¥çº¿ç¨‹é‡Šæ”¾é”åæ‰èƒ½è·å¾—é”ã€‚



## å¯¹äºåŠ é”ï¼Œé‚£å†è¯´ä¸‹ReentrantLockåŸç†ï¼Ÿä»–å’Œsynchronizedæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

ReentrantLockéœ€è¦**æ˜¾å¼çš„è·å–é”å’Œé‡Šæ”¾é”**

1. **ç­‰å¾…å¯ä¸­æ–­**ï¼Œå½“æŒæœ‰é”çš„çº¿ç¨‹é•¿æ—¶é—´ä¸é‡Šæ”¾é”çš„æ—¶å€™ï¼Œç­‰å¾…ä¸­çš„çº¿ç¨‹å¯ä»¥é€‰æ‹©æ”¾å¼ƒç­‰å¾…ï¼Œè½¬è€Œå¤„ç†å…¶ä»–çš„ä»»åŠ¡ã€‚

2. **å…¬å¹³é”**ï¼š`synchronized`å’Œ`ReentrantLock`é»˜è®¤éƒ½æ˜¯éå…¬å¹³é”ï¼Œä½†æ˜¯ReentrantLockå¯ä»¥é€šè¿‡æ„é€ å‡½æ•°ä¼ å‚æ”¹å˜ã€‚åªä¸è¿‡ä½¿ç”¨å…¬å¹³é”çš„è¯ä¼šå¯¼è‡´æ€§èƒ½æ€¥å‰§ä¸‹é™ã€‚

   ```java
   public ReentrantLock(boolean fair) {
           sync = fair ? new FairSync() : new NonfairSync();
       }
   ```

   

3. **ç»‘å®šå¤šä¸ªæ¡ä»¶**ï¼šReentrantLockå¯ä»¥åŒæ—¶ç»‘å®šå¤šä¸ªConditionæ¡ä»¶å¯¹è±¡ã€‚

[javaå¹¶å‘æ§åˆ¶ï¼šReentrantLock Conditionä½¿ç”¨è¯¦è§£-é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒº (aliyun.com)](https://developer.aliyun.com/article/384548)

```java
package com.Test;

import org.junit.Test;

import java.util.concurrent.locks.Condition;
import java.util.concurrent.locks.Lock;
import java.util.concurrent.locks.ReentrantLock;

/**
 * @Description TODO
 * @Date 2021/10/28 22:43
 * @Created by æŠ˜è…¾çš„å°é£
 */
public class ReentrantLockDemo {
    /**
     * description: æˆ‘ä»¬è¦æ‰“å°1åˆ°9è¿™9ä¸ªæ•°å­—ï¼Œç”±Açº¿ç¨‹å…ˆæ‰“å°1ï¼Œ2ï¼Œ3ï¼Œç„¶åç”±Bçº¿ç¨‹æ‰“å°4,5,6ï¼Œ
     * ç„¶åå†ç”±Açº¿ç¨‹æ‰“å°7ï¼Œ8ï¼Œ9. è¿™é“é¢˜æœ‰å¾ˆå¤šç§è§£æ³•ï¼Œ
     * ç°åœ¨æˆ‘ä»¬ä½¿ç”¨Conditionæ¥åšè¿™é“é¢˜ï¼ˆä½¿ç”¨Objectçš„waitï¼Œnotifyæ–¹æ³•çš„è§£æ³•åœ¨è¿™é‡Œï¼‰ã€‚
     *
     * @since: 1.0.0
     * @author: æ¶‚éŠé£tu_aofei@163.com
     * @date: 2021/10/28 22:49
     * @return: void
     */
    static class NumberWrapper {
        public int value = 1;
    }

    /*
    åˆå§‹åŒ–å¯é‡å…¥é”
     */
    final Lock lock = new ReentrantLock();

    @Test
    public void Demo() {
        //ç¬¬ä¸€ä¸ªæ¡ä»¶å½“å±å¹•ä¸Šè¾“å‡ºåˆ°3
        final Condition reachThreeCondition = lock.newCondition();
        //ç¬¬äºŒä¸ªæ¡ä»¶å½“å±å¹•ä¸Šè¾“å‡ºåˆ°6
        final Condition reachSixCondition = lock.newCondition();

        //NumberWrapperåªæ˜¯ä¸ºäº†å°è£…ä¸€ä¸ªæ•°å­—ï¼Œä¸€è¾¹å¯ä»¥å°†æ•°å­—å¯¹è±¡å…±äº«ï¼Œå¹¶å¯ä»¥è®¾ç½®ä¸ºfinal
        //æ³¨æ„è¿™é‡Œä¸è¦ç”¨Integer, Integer æ˜¯ä¸å¯å˜å¯¹è±¡
        final NumberWrapper num = new NumberWrapper();

        //åˆå§‹åŒ–Açº¿ç¨‹
        Thread threadA= new Thread(new Runnable() {
            public void run() {
                //éœ€è¦å…ˆè·å¾—é”
                lock.lock();
                try {
                    System.out.println("threadA start write");
                    //Açº¿ç¨‹å…ˆè¾“å‡ºå‰3ä¸ªæ•°
                    while (num.value <= 3) {
                        System.out.println(num.value);
                        num.value++;
                    }
                    //è¾“å‡ºåˆ°3æ—¶è¦signalï¼Œå‘Šè¯‰Bçº¿ç¨‹å¯ä»¥å¼€å§‹äº†
                    reachThreeCondition.signal();
                }finally {
                    lock.unlock();
                }
                lock.lock();
                try{
                    //ç­‰å¾…è¾“å‡º6çš„æ¡ä»¶
                    reachSixCondition.await();
                    System.out.println("threadA start write");
                    //è¾“å‡ºå‰©ä½™æ•°å­—
                    while (num.value <= 9) {
                        System.out.println(num.value);
                        num.value++;
                    }
                }catch (InterruptedException e) {
                    e.printStackTrace();
                } finally {

                }
            }
        });

        Thread threadB = new Thread(new Runnable() {
            public void run() {
                try {
                    lock.lock();

                    while (num.value <= 3) {
                        //ç­‰å¾…3è¾“å‡ºå®Œæ¯•çš„ä¿¡å·
                        reachThreeCondition.await();
                    }
                } catch (InterruptedException e) {
                    e.printStackTrace();
                } finally {
                    lock.unlock();
                }
                try {
                    lock.lock();
                    //å·²ç»æ”¶åˆ°ä¿¡å·ï¼Œå¼€å§‹è¾“å‡º4ï¼Œ5ï¼Œ6
                    System.out.println("threadB start write");
                    while (num.value <= 6) {
                        System.out.println(num.value);
                        num.value++;
                    }
                    //4ï¼Œ5ï¼Œ6è¾“å‡ºå®Œæ¯•ï¼Œå‘Šè¯‰Açº¿ç¨‹6è¾“å‡ºå®Œäº†
                    reachSixCondition.signal();
                } finally {
                    lock.unlock();
                }
            }

        });
        threadA.start();
        threadB.start();
    }
}
```

![image-20211030193235932](https://raw.githubusercontent.com/731016/imgSave/master/202110301932120.png)


## é¡¹ç›®åœ°å€

ç¼–ç¨‹å¯¼èˆªï¼šhttps://www.codefather.cn/course/1915010091721236482

## é¡¹ç›®æ€»è§ˆ

- é¡¹ç›®ä»‹ç»

  AI Javaåç«¯å¼€å‘å¤§å¸ˆ+è‡ªä¸»è§„åˆ’èƒ½åŠ›çš„æ™ºèƒ½ä½“

- é¡¹ç›®ä¼˜åŠ¿

  - ä¸»æµ AI åº”ç”¨å¹³å°çš„ä½¿ç”¨
  - AI å¤§æ¨¡å‹çš„ 4 ç§æ¥å…¥æ–¹å¼
  - AI å¼€å‘æ¡†æ¶ï¼ˆSpring AI + LangChain4jï¼‰
  - AI å¤§æ¨¡å‹æœ¬åœ°éƒ¨ç½²
  - Prompt å·¥ç¨‹å’Œä¼˜åŒ–æŠ€å·§
  - Spring AI æ ¸å¿ƒç‰¹æ€§ï¼šå¦‚è‡ªå®šä¹‰ Advisorã€å¯¹è¯è®°å¿†ã€ç»“æ„åŒ–è¾“å‡º
  - RAG çŸ¥è¯†åº“å®æˆ˜ã€åŸç†å’Œè°ƒä¼˜æŠ€å·§
  - PgVector å‘é‡æ•°æ®åº“ + äº‘æ•°æ®åº“æœåŠ¡
  - Tool Calling å·¥å…·è°ƒç”¨å®æˆ˜åŠåŸç†
  - MCP æ¨¡å‹ä¸Šä¸‹æ–‡åè®®å’ŒæœåŠ¡å¼€å‘
  - AI æ™ºèƒ½ä½“ Manus åŸç†å’Œè‡ªä¸»å¼€å‘
  - AI æœåŠ¡åŒ–å’Œ Serverless éƒ¨ç½²ä¸Šçº¿
  - å„ç§æ–°æ¦‚å¿µï¼šå¦‚å¤šæ¨¡æ€ã€æ™ºèƒ½ä½“å·¥ä½œæµã€A2A åè®®ã€å¤§æ¨¡å‹è¯„ä¼°ç­‰

- é¡¹ç›®åŠŸèƒ½æ¢³ç†

  - AI Javaåç«¯å¼€å‘å¤§å¸ˆåº”ç”¨ï¼šç”¨æˆ·åœ¨å¼€å‘è¿‡ç¨‹ä¸­éš¾å…é‡åˆ°å„ç§éš¾é¢˜ï¼Œè®© AI ä¸ºç”¨æˆ·æä¾›è´´å¿ƒæŒ‡å¯¼ã€‚æ”¯æŒå¤šè½®å¯¹è¯ã€å¯¹è¯è®°å¿†æŒä¹…åŒ–ã€RAG çŸ¥è¯†åº“æ£€ç´¢ã€å·¥å…·è°ƒç”¨ã€MCP æœåŠ¡è°ƒç”¨ã€‚
  - AI è¶…çº§æ™ºèƒ½ä½“ï¼šå¯ä»¥æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚ï¼Œè‡ªä¸»æ¨ç†å’Œè¡ŒåŠ¨ï¼Œç›´åˆ°å®Œæˆç›®æ ‡ã€‚
  - æä¾›ç»™ AI çš„å·¥å…·ï¼šåŒ…æ‹¬è”ç½‘æœç´¢ã€æ–‡ä»¶æ“ä½œã€ç½‘é¡µæŠ“å–ã€èµ„æºä¸‹è½½ã€ç»ˆç«¯æ“ä½œã€PDF ç”Ÿæˆã€‚
  - AI MCP æœåŠ¡ï¼šå¯ä»¥ä»ç‰¹å®šç½‘ç«™æœç´¢å›¾ç‰‡ã€‚

- æŠ€æœ¯é€‰å‹

  - Java 21 + Spring Boot 3 æ¡†æ¶
  - â­ï¸ Spring AI + LangChain4j
  - â­ï¸ RAG çŸ¥è¯†åº“
  - â­ï¸ PGvector å‘é‡æ•°æ®åº“
  - â­ Tool Calling å·¥å…·è°ƒç”¨
  - â­ï¸ MCP æ¨¡å‹ä¸Šä¸‹æ–‡åè®®
  - â­ï¸ ReAct Agent æ™ºèƒ½ä½“æ„å»º
  - â­ï¸ Serverless è®¡ç®—æœåŠ¡
  - â­ï¸ AI å¤§æ¨¡å‹å¼€å‘å¹³å°ç™¾ç‚¼
  - â­ï¸ Cursor AI ä»£ç ç”Ÿæˆ
  - â­ï¸ SSE å¼‚æ­¥æ¨é€
  - ç¬¬ä¸‰æ–¹æ¥å£ï¼šå¦‚ SearchAPI / Pexels API
  - Ollama å¤§æ¨¡å‹éƒ¨ç½²
  - å·¥å…·åº“å¦‚ï¼šKryo é«˜æ€§èƒ½åºåˆ—åŒ– + Jsoup ç½‘é¡µæŠ“å– + iText PDF ç”Ÿæˆ + Knife4j æ¥å£æ–‡æ¡£

- æ¶æ„è®¾è®¡

  ![image-20250808222359833](https://note-1259190304.cos.ap-chengdu.myqcloud.com/noteimage-20250808222359833.png)

## AI å¤§æ¨¡å‹æ¥å…¥

### AI å¤§æ¨¡å‹æ¦‚å¿µ

### æ¥å…¥ AI å¤§æ¨¡å‹ï¼ˆ3 ç§æ–¹å¼ï¼‰

### åç«¯é¡¹ç›®åˆå§‹åŒ–

### ç¨‹åºè°ƒç”¨ AI å¤§æ¨¡å‹ï¼ˆ4 ç§æ–¹å¼ï¼‰

- SDK
- HTTP
- Spring Ai
- LangChain4j

### æœ¬åœ°éƒ¨ç½² AI å¤§æ¨¡å‹

[Ollama](https://ollama.com/)

### Spring AI è°ƒç”¨æœ¬åœ°å¤§æ¨¡å‹

[Ollama-é˜¿é‡Œäº‘Spring AI Alibabaå®˜ç½‘å®˜ç½‘](https://java2ai.com/docs/1.0.0-M6.1/models/ollama/)

## AI åº”ç”¨å¼€å‘

### Prompt å·¥ç¨‹æ¦‚å¿µ

æç¤ºè¯å·¥ç¨‹

Tokenï¼šå•è¯æˆ–æ ‡ç‚¹ç¬¦å·

#### æç¤ºè¯è®¡ç®—å·¥å…·

[OpenAI Tokens åœ¨çº¿è®¡ç®—å·¥å…· - AIGC2D.com](https://tiktoken.aigc2d.com/)

[Attention Required! | Cloudflare](https://platform.openai.com/tokenizer)

![image-20250813223613711](https://note-1259190304.cos.ap-chengdu.myqcloud.com/noteimage-20250813223613711.png)

### æˆæœ¬ä¼˜åŒ–

1. ç²¾ç®€æç¤ºè¯
2. å®šæœŸæ¸…ç†å¯¹è¯å†å²
3. ä½¿ç”¨å‘é‡æ£€ç´¢ä»£æ›¿ç›´æ¥è¾“å…¥
4. ç»“æ„åŒ–æ›¿ä»£è‡ªç„¶è¯­è¨€

### Prompt ä¼˜åŒ–æŠ€å·§



#### **promptå­¦ä¹ **

[æç¤ºå·¥ç¨‹æŒ‡å— | Prompt Engineering Guide](https://www.promptingguide.ai/zh)

[Attention Required! | Cloudflare](https://platform.openai.com/docs/guides/prompt-engineering)

[Prompts :: Spring AI Reference](https://docs.spring.io/spring-ai/reference/api/prompt.html#_prompt_engineering)

[æç¤ºå·¥ç¨‹æ¦‚è¿° - Anthropic](https://docs.anthropic.com/zh-CN/docs/build-with-claude/prompt-engineering/overview)

[GitHub - anthropics/prompt-eng-interactive-tutorial: Anthropic's Interactive Prompt Engineering Tutorial](https://github.com/anthropics/prompt-eng-interactive-tutorial)

[æ™ºè°±AIå¼€æ”¾å¹³å°](https://open.bigmodel.cn/dev/guidelines/LanguageModels)

#### **promptæå‡è¯åº“**

[Home - Anthropic](https://docs.anthropic.com/en/home)

[Prompt Library - Free Midjourney Prompts - ChatGPT, Gemini, Dall-e Image Prompts](https://promptlibrary.org/)





### Javaåç«¯å¼€å‘å¤§å¸ˆåº”ç”¨éœ€æ±‚åˆ†æ

### Javaåç«¯å¼€å‘å¤§å¸ˆåº”ç”¨æ–¹æ¡ˆè®¾è®¡

#### ç³»ç»Ÿæç¤ºè¯è®¾è®¡

```
æ‰®æ¼”æ·±è€•Javaåç«¯å¼€å‘é¢†åŸŸçš„ä¸“å®¶ã€‚å¼€åœºå‘ç”¨æˆ·è¡¨æ˜èº«ä»½ï¼Œå‘ŠçŸ¥ç”¨æˆ·é‡åˆ°çš„éš¾é¢˜æˆ–ä¸æ˜ç™½çš„å…³é”®è¯ï¼›
å›´ç»•ç¼–ç¨‹å­¦ä¹ è®°å½•ï¼ŒåŒ…æ‹¬Javaï¼ŒSpringï¼ŒSpringMVCï¼ŒSpringBootï¼ŒSpringCloudï¼Œè®¾è®¡æ¨¡å¼ï¼ŒJavaScriptï¼ŒLinuxï¼ŒSqlï¼Œæ•°æ®åº“ï¼ŒRedisï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå‰ç«¯ï¼ŒGitï¼ŒSVNï¼ŒCè¯­è¨€ï¼ŒPythonï¼Œè®¡ç®—æœºç½‘ç»œï¼Œå¼€å‘ç¯å¢ƒé…ç½®ï¼Œç”Ÿäº§ç¯å¢ƒé—®é¢˜æ’æŸ¥ï¼Œé¢è¯•èµ„æ–™ï¼›åŒ…æ‹¬è½¯è€ƒä¸­çº§è½¯ä»¶è®¾è®¡å¸ˆï¼Œé«˜ç­‰æ•°å­¦ï¼ŒåŠ³åŠ¨åˆåŒæ³•ï¼Œ
è¿™äº›çŸ¥è¯†ç‚¹æé—®ï¼šè¯¢é—®é‡åˆ°çš„å…·ä½“ä¸æ˜ç™½çš„åœ°æ–¹æˆ–è€…é‡åˆ°bugå‡ºç°çš„æŠ¥é”™ä¿¡æ¯ï¼›
å¼•å¯¼ç”¨æˆ·è¯¦è¿°ä¸æ¸…æ¥šçš„åœ°æ–¹ã€bugã€æŠ¥é”™ä¿¡æ¯ï¼Œä»¥ä¾¿ç»™å‡ºå¯¹åº”çš„ç­”æ¡ˆã€‚
```

#### å¤šè½®å¯¹è¯å®ç°

[Chat Client API :: Spring AI Reference](https://docs.spring.io/spring-ai/reference/api/chatclient.html)

### Spring AI ChatClient / Advisor / ChatMemory ç‰¹æ€§

#### ChatClient

#### Advisor

å¢å¼ºï¼Œç›¸å½“äºæ‹¦æˆªå™¨

#### Chat Memory Advisor

MessageChatMemoryAdvisorï¼šä»è®°å¿†ä¸­æ£€ç´¢å†å²å¯¹è¯ï¼Œå°†å…¶ä½œä¸ºæ¶ˆæ¯é›†åˆæ·»åŠ åˆ°æç¤ºè¯ï¼›ä¿ç•™åŸå§‹ä¿¡æ¯

PromptChatMemoryAdvisorï¼šä»è®°å¿†ä¸­æ£€ç´¢å†å²å¯¹è¯ï¼Œå°†å…¶åŠ å…¥æç¤ºè¯çš„ç³»ç»Ÿæ–‡æœ¬ï¼›å¯èƒ½ä¸¢å¤±è¾¹ç•Œ

VectorStoreChatMemoryAdvisorï¼šç”¨å‘é‡æ•°æ®åº“æ¥å­˜å‚¨æ£€ç´¢å†å²å¯¹è¯



#### Chat Memory

å¯å°†å¯¹è¯ä¿å­˜åˆ°ä¸åŒçš„æ•°æ®æº

![image-20250813230745381](https://note-1259190304.cos.ap-chengdu.myqcloud.com/noteimage-20250813230745381.png)



### å¤šè½®å¯¹è¯ AI åº”ç”¨å¼€å‘



```java
@Component
@Slf4j
public class LoveApp {

    private final ChatClient chatClient;

    private static final String SYSTEM_PROMPT = "æ‰®æ¼”æ·±è€•Javaåç«¯å¼€å‘é¢†åŸŸçš„ä¸“å®¶ã€‚å¼€åœºå‘ç”¨æˆ·è¡¨æ˜èº«ä»½ï¼Œå‘ŠçŸ¥ç”¨æˆ·é‡åˆ°çš„éš¾é¢˜æˆ–ä¸æ˜ç™½çš„å…³é”®è¯ã€‚" +
            "å›´ç»•ç¼–ç¨‹å­¦ä¹ è®°å½•ï¼ŒåŒ…æ‹¬Javaï¼ŒSpringï¼ŒSpringMVCï¼ŒSpringBootï¼ŒSpringCloudï¼Œè®¾è®¡æ¨¡å¼ï¼ŒJavaScriptï¼ŒLinuxï¼ŒSqlï¼Œæ•°æ®åº“ï¼ŒRedisï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå‰ç«¯ï¼ŒGitï¼ŒSVNï¼ŒCè¯­è¨€ï¼ŒPythonï¼Œè®¡ç®—æœºç½‘ç»œï¼Œå¼€å‘ç¯å¢ƒé…ç½®ï¼Œç”Ÿäº§ç¯å¢ƒé—®é¢˜æ’æŸ¥ï¼Œé¢è¯•èµ„æ–™ï¼›åŒ…æ‹¬è½¯è€ƒä¸­çº§è½¯ä»¶è®¾è®¡å¸ˆï¼Œé«˜ç­‰æ•°å­¦ï¼ŒåŠ³åŠ¨åˆåŒæ³•" +
            "è¿™äº›çŸ¥è¯†ç‚¹æé—®ï¼šè¯¢é—®é‡åˆ°çš„å…·ä½“ä¸æ˜ç™½çš„åœ°æ–¹æˆ–è€…é‡åˆ°bugå‡ºç°çš„æŠ¥é”™ä¿¡æ¯ï¼›" +
            "å¼•å¯¼ç”¨æˆ·è¯¦è¿°ä¸æ¸…æ¥šçš„åœ°æ–¹ã€bugã€æŠ¥é”™ä¿¡æ¯ï¼Œä»¥ä¾¿ç»™å‡ºå¯¹åº”çš„ç­”æ¡ˆã€‚";

     /**
     * åˆå§‹åŒ– ChatClient
     *
     * @param dashscopeChatModel
     */
    public LoveApp(ChatModel dashscopeChatModel) {
//        // åˆå§‹åŒ–åŸºäºæ–‡ä»¶çš„å¯¹è¯è®°å¿†
//        String fileDir = System.getProperty("user.dir") + "/tmp/chat-memory";
//        ChatMemory chatMemory = new FileBasedChatMemory(fileDir);
        // åˆå§‹åŒ–åŸºäºå†…å­˜çš„å¯¹è¯è®°å¿†
        MessageWindowChatMemory chatMemory = MessageWindowChatMemory.builder()
                .chatMemoryRepository(new InMemoryChatMemoryRepository())
                .maxMessages(20)
                .build();
        chatClient = ChatClient.builder(dashscopeChatModel)
                .defaultSystem(SYSTEM_PROMPT)
                .defaultAdvisors(
                        MessageChatMemoryAdvisor.builder(chatMemory).build(),
                        // è‡ªå®šä¹‰æ—¥å¿— Advisorï¼Œå¯æŒ‰éœ€å¼€å¯
                        new MyLoggerAdvisor()
//                        // è‡ªå®šä¹‰æ¨ç†å¢å¼º Advisorï¼Œå¯æŒ‰éœ€å¼€å¯
                       ,new ReReadingAdvisor()
                )
                .build();
    }
    
    
    public String doChat(String message, String chatId) {
    ChatResponse response = chatClient
            .prompt()
            .user(message)
            .advisors(spec -> spec.param(CHAT_MEMORY_CONVERSATION_ID_KEY, chatId)
                    .param(CHAT_MEMORY_RETRIEVE_SIZE_KEY, 10))
            .call()
            .chatResponse();
    String content = response.getResult().getOutput().getText();
    log.info("content: {}", content);
    return content;
}

}
```



```java
@SpringBootTest
class LoveAppTest {

    @Resource
    private LoveApp loveApp;

    @Test
    void testChat() {
        String chatId = UUID.randomUUID().toString();
        // ç¬¬ä¸€è½®
        String message = "ä½ å¥½ï¼Œæˆ‘æ˜¯æŠ˜è…¾çš„å°é£";
        String answer = loveApp.doChat(message, chatId);
        // ç¬¬äºŒè½®
        message = "æˆ‘æƒ³çŸ¥é“javaçš„ä¸‰å¤§ç‰¹æ€§";
        answer = loveApp.doChat(message, chatId);
        Assertions.assertNotNull(answer);
        // ç¬¬ä¸‰è½®
        message = "æˆ‘å«ä»€ä¹ˆæ¥ç€ï¼Ÿåˆšè·Ÿä½ è¯´è¿‡ï¼Œå¸®æˆ‘å›å¿†ä¸€ä¸‹";
        answer = loveApp.doChat(message, chatId);
        Assertions.assertNotNull(answer);
    }
}
```

è°ƒæ•´åˆå§‹åŒ–ChatClientçš„å¯¹è¯è®°å¿†å¤§å°ä¸º1

```java
// åˆå§‹åŒ–åŸºäºå†…å­˜çš„å¯¹è¯è®°å¿†
        MessageWindowChatMemory chatMemory = MessageWindowChatMemory.builder()
                .chatMemoryRepository(new InMemoryChatMemoryRepository())
                .maxMessages(1)
                .build();
```

ç›´æ¥æ–­ç‰‡äº†

![image-20250820225725921](https://note-1259190304.cos.ap-chengdu.myqcloud.com/noteimage-20250820225725921.png)



### Spring AI è‡ªå®šä¹‰ Advisor

ï¼ˆ1ï¼‰å®ç°æ¥å£

CallAroundAdvisorï¼šå¤„ç†åŒæ­¥è¯·æ±‚å’Œå“åº”
StreamAroundAdvisorï¼š å¤„ç†æµå¼è¯·æ±‚å’Œå“åº”

```java
public class MyCustomAdvisor implements CallAroundAdvisor, StreamAroundAdvisor {
    // å®ç°æ–¹æ³•...
}
```

ï¼ˆ2ï¼‰å®ç°æ ¸å¿ƒæ–¹æ³•

CallAroundAdvisorçš„aroundCall

```java
@Override
public AdvisedResponse aroundCall(AdvisedRequest advisedRequest, CallAroundAdvisorChain chain) {
    // 1. å¤„ç†è¯·æ±‚ï¼ˆå‰ç½®å¤„ç†ï¼‰
    AdvisedRequest modifiedRequest = processRequest(advisedRequest);
    
    // 2. è°ƒç”¨é“¾ä¸­çš„ä¸‹ä¸€ä¸ªAdvisor
    AdvisedResponse response = chain.nextAroundCall(modifiedRequest);
    
    // 3. å¤„ç†å“åº”ï¼ˆåç½®å¤„ç†ï¼‰
    return processResponse(response);
}
```



æµå¼å¤„ç†StreamAroundAdvisorçš„aroundStream

```java
@Override
public Flux<AdvisedResponse> aroundStream(AdvisedRequest advisedRequest, StreamAroundAdvisorChain chain) {
    // 1. å¤„ç†è¯·æ±‚
    AdvisedRequest modifiedRequest = processRequest(advisedRequest);
    
    // 2. è°ƒç”¨é“¾ä¸­çš„ä¸‹ä¸€ä¸ªAdvisorå¹¶å¤„ç†æµå¼å“åº”
    return chain.nextAroundStream(modifiedRequest)
               .map(response -> processResponse(response));
}
```

ï¼ˆ3ï¼‰æ‰§è¡Œé¡ºåº

```java
@Override
public int getOrder() {
    // å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œ
    return 100; 
}
```

ï¼ˆ4ï¼‰å”¯ä¸€åç§°

```java
@Override
public String getName() {
    return "è‡ªå®šä¹‰çš„ Advisor";
}
```



spring aiçš„å†…ç½®simpleloggeradvisoræ—¥å¿—æ‹¦æˆªå™¨é»˜è®¤æ‰“å°debugçº§åˆ«æ—¥å¿—ï¼Œspringbooté»˜è®¤æ—¥å¿—çº§åˆ«ä¸ºinfo

```yaml
logging:
  level:
    org.springframework.ai.chat.client.advisor.SimpleLoggerAdvisor: debug
```

#### è‡ªå®šä¹‰æ—¥å¿— advisor

ä¸æƒ³ä¿®æ”¹æ—¥å¿—çº§åˆ«ï¼Œè‡ªå®šä¹‰ä¸€ä¸ª

```java
/**
 * è‡ªå®šä¹‰æ—¥å¿— Advisor
 * æ‰“å° info çº§åˆ«æ—¥å¿—ã€åªè¾“å‡ºå•æ¬¡ç”¨æˆ·æç¤ºè¯å’Œ AI å›å¤çš„æ–‡æœ¬
 */
@Slf4j
public class MyLoggerAdvisor implements CallAroundAdvisor, StreamAroundAdvisor {

    @Override
    public String getName() {
        return this.getClass().getSimpleName();
    }

    @Override
    public int getOrder() {
        return 0;
    }

    private AdvisedRequest before(AdvisedRequest request) {
        log.info("AI Request: {}", request.userText());
        return request;
    }

    private void observeAfter(AdvisedResponse advisedResponse) {
        log.info("AI Response: {}", advisedResponse.response().getResult().getOutput().getText());
    }

    public AdvisedResponse aroundCall(AdvisedRequest advisedRequest, CallAroundAdvisorChain chain) {
        advisedRequest = this.before(advisedRequest);
        AdvisedResponse advisedResponse = chain.nextAroundCall(advisedRequest);
        this.observeAfter(advisedResponse);
        return advisedResponse;
    }

    public Flux<AdvisedResponse> aroundStream(AdvisedRequest advisedRequest, StreamAroundAdvisorChain chain) {
        advisedRequest = this.before(advisedRequest);
        Flux<AdvisedResponse> advisedResponses = chain.nextAroundStream(advisedRequest);
        return (new MessageAggregator()).aggregateAdvisedResponse(advisedResponses, this::observeAfter);
    }
}

```



#### è‡ªå®šä¹‰Re-Reading advisor

[Advisors API :: Spring AI Reference](https://docs.spring.io/spring-ai/reference/api/advisors.html#_re_reading_re2_advisor)

è¯¥æŠ€æœ¯é€šè¿‡è®©æ¨¡å‹é‡æ–°é˜…è¯»é—®é¢˜æ¥æé«˜æ¨ç†èƒ½åŠ›ï¼Œæœ‰ [æ–‡çŒ®](https://arxiv.org/pdf/2309.06275) æ¥å°è¯å®ƒçš„æ•ˆæœã€‚

> ğŸ’¡ æ³¨æ„â€ï¼Œè™½ç„¶è¯¥æŠ€æœ¯å¯æé«˜å¤§ï»¿è¯­è¨€æ¨¡å‹çš„æ¨ç†èƒ½åŠ›ï¼Œä¸è¿‡æˆæœ¬ä¼šåŠ å€ï¼æ‰€ä»¥å¦‚æœ AI åº”ç”¨è¦é¢â¡å‘ C ç«¯å¼€æ”¾ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚

Re2 çš„â€å®ç°åŸç†å¾ˆç®€å•ï¼Œæ”¹ï»¿å†™ç”¨æˆ· Prompt ä¸ºä¸‹åˆ—æ ¼å¼ï¼Œä¹Ÿå°±æ˜¯è®© AI é‡å¤â¡é˜…è¯»ç”¨æˆ·çš„è¾“å…¥ï¼š

```markdown
{Input_Query}
Read the question again: {Input_Query}
```

éœ€è¦å¯¹è¯·æ±‚è¿›â€è¡Œæ‹¦æˆªå¹¶æ”¹å†™ userï»¿Textï¼Œå¯¹åº”çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š

```java
/**
 * è‡ªå®šä¹‰ Re2 Advisor
 * å¯æé«˜å¤§å‹è¯­è¨€æ¨¡å‹çš„æ¨ç†èƒ½åŠ›
 */
public class ReReadingAdvisor implements CallAdvisor, StreamAdvisor {

    /**
     * æ‰§è¡Œè¯·æ±‚å‰ï¼Œæ”¹å†™ Prompt
     *
     * @param chatClientRequest
     * @return
     */
    private ChatClientRequest before(ChatClientRequest chatClientRequest) {
        String userText = chatClientRequest.prompt().getUserMessage().getText();
        // æ·»åŠ ä¸Šä¸‹æ–‡å‚æ•°
        chatClientRequest.context().put("re2_input_query", userText);
        // ä¿®æ”¹ç”¨æˆ·æç¤ºè¯
        String newUserText = """
                %s
                Read the question again: %s
                """.formatted(userText, userText);
        Prompt newPrompt = chatClientRequest.prompt().augmentUserMessage(newUserText);
        return new ChatClientRequest(newPrompt, chatClientRequest.context());
    }

    @Override
    public ChatClientResponse adviseCall(ChatClientRequest chatClientRequest, CallAdvisorChain chain) {
        return chain.nextCall(this.before(chatClientRequest));
    }

    @Override
    public Flux<ChatClientResponse> adviseStream(ChatClientRequest chatClientRequest, StreamAdvisorChain chain) {
        return chain.nextStream(this.before(chatClientRequest));
    }

    @Override
    public int getOrder() {
        return 0;
    }

    @Override
    public String getName() {
        return this.getClass().getSimpleName();
    }
}
```



ä¿®æ”¹åå¯æµ‹è¯•ä½¿ï»¿ç”¨ Advisorï¼Œå¹¶è¿›è¡Œæµ‹è¯•ï¼ŒæŸ¥çœ‹è¯·æ±‚æ˜¯å¦è¢«æ”¹å†™ã€‚

```java
/**
     * åˆå§‹åŒ– ChatClient
     *
     * @param dashscopeChatModel
     */
    public LoveApp(ChatModel dashscopeChatModel) {
//        // åˆå§‹åŒ–åŸºäºæ–‡ä»¶çš„å¯¹è¯è®°å¿†
//        String fileDir = System.getProperty("user.dir") + "/tmp/chat-memory";
//        ChatMemory chatMemory = new FileBasedChatMemory(fileDir);
        // åˆå§‹åŒ–åŸºäºå†…å­˜çš„å¯¹è¯è®°å¿†
        MessageWindowChatMemory chatMemory = MessageWindowChatMemory.builder()
                .chatMemoryRepository(new InMemoryChatMemoryRepository())
                .maxMessages(20)
                .build();
        chatClient = ChatClient.builder(dashscopeChatModel)
                .defaultSystem(SYSTEM_PROMPT)
                .defaultAdvisors(
                        MessageChatMemoryAdvisor.builder(chatMemory).build(),
                        // è‡ªå®šä¹‰æ—¥å¿— Advisorï¼Œå¯æŒ‰éœ€å¼€å¯
                        new MyLoggerAdvisor()
//                        // è‡ªå®šä¹‰æ¨ç†å¢å¼º Advisorï¼Œå¯æŒ‰éœ€å¼€å¯
                       ,new ReReadingAdvisor()
                )
                .build();
    }
```

![image-20250820231552937](https://note-1259190304.cos.ap-chengdu.myqcloud.com/noteimage-20250820231552937.png)

#### æœ€ä½³å®è·µ

1ï¼‰ä¿æŒå•â€ä¸€èŒè´£ï¼šæ¯ä¸ª Adï»¿visor åº”ä¸“æ³¨äºä¸€é¡¹ç‰¹å®šä»»åŠ¡

2ï¼‰æ³¨æ„æ‰§è¡Œé¡ºåºï¼šåˆç†è®¾ç½®`getOrder()`å€¼ç¡®ä¿ Advisor æŒ‰æ­£ç¡®é¡ºåºæ‰§è¡Œ

3ï¼‰åŒæ—¶æ”¯â€æŒæµå¼å’Œéæµå¼ï¼šå°½ï»¿å¯èƒ½åŒæ—¶å®ç°ä¸¤ç§æ¥å£ä»¥æé«˜çµæ´»æ€§

4ï¼‰é«˜æ•ˆå¤„ç†è¯·æ±‚ï¼šé¿å…åœ¨ Advisor ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ

5ï¼‰æµ‹è¯•è¾¹â€ç•Œæƒ…å†µï¼šç¡®ä¿ Adï»¿visor èƒ½å¤Ÿä¼˜é›…å¤„ç†å¼‚å¸¸å’Œè¾¹ç•Œæƒ…å†µ

6ï¼‰å¯¹äºéœ€â€è¦æ›´å¤æ‚å¤„ç†çš„æµå¼ï»¿åœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨ Reactor çš„æ“ä½œç¬¦ï¼š

```java
@Override
public Flux<AdvisedResponse> aroundStream(AdvisedRequest advisedRequest, StreamAroundAdvisorChain chain) {
    return Mono.just(advisedRequest)
           .publishOn(Schedulers.boundedElastic())
           .map(request -> {
               // è¯·æ±‚å‰å¤„ç†é€»è¾‘
               return modifyRequest(request);
           })
           .flatMapMany(request -> chain.nextAroundStream(request))
           .map(response -> {
               // å“åº”å¤„ç†é€»è¾‘
               return modifyResponse(response);
           });
}
```

7ï¼‰å¯ä»¥ä½¿ç”¨ `adviseContext` åœ¨ Advisor é“¾ä¸­å…±äº«çŠ¶æ€ï¼š

```java
// æ›´æ–°ä¸Šä¸‹æ–‡
advisedRequest = advisedRequest.updateContext(context -> {
    context.put("key", "value");
    return context;
});

// è¯»å–ä¸Šä¸‹æ–‡
Object value = advisedResponse.adviseContext().get("key");
```



### Spring AI ç»“æ„åŒ–è¾“å‡º - çŸ¥è¯†æŠ¥å‘ŠåŠŸèƒ½



### Spring AI å¯¹è¯è®°å¿†æŒä¹…åŒ–



### Spring AI Prompt æ¨¡æ¿ç‰¹æ€§



### å¤šæ¨¡æ€æ¦‚å¿µå’Œå¼€å‘



## RAG çŸ¥è¯†åº“åŸºç¡€

### AI Javaå¼€å‘çŸ¥è¯†é—®ç­”éœ€æ±‚åˆ†æ

### RAG æ¦‚å¿µï¼ˆé‡ç‚¹ç†è§£æ ¸å¿ƒæ­¥éª¤ï¼‰

### RAG å®æˆ˜ï¼šSpring AI + æœ¬åœ°çŸ¥è¯†åº“

### RAG å®æˆ˜ï¼šSpring AI + äº‘çŸ¥è¯†åº“æœåŠ¡

## RAG çŸ¥è¯†åº“è¿›é˜¶

### RAG æ ¸å¿ƒç‰¹æ€§

#### æ–‡æ¡£æ”¶é›†å’Œåˆ‡å‰²ï¼ˆETLï¼‰

#### å‘é‡è½¬æ¢å’Œå­˜å‚¨ï¼ˆå‘é‡æ•°æ®åº“ï¼‰

#### æ–‡æ¡£è¿‡æ»¤å’Œæ£€ç´¢ï¼ˆæ–‡æ¡£æ£€ç´¢å™¨ï¼‰

#### æŸ¥è¯¢å¢å¼ºå’Œå…³è”ï¼ˆä¸Šä¸‹æ–‡æŸ¥è¯¢å¢å¼ºå™¨ï¼‰

### RAG æœ€ä½³å®è·µå’Œè°ƒä¼˜

### æ£€ç´¢ç­–ç•¥

### å¤§æ¨¡å‹å¹»è§‰

## å·¥å…·è°ƒç”¨

### å·¥å…·æ¦‚å¿µ

#### Spring AI å·¥å…·å¼€å‘

#### ä¸»æµå·¥å…·å¼€å‘

##### æ–‡ä»¶æ“ä½œ

##### è”ç½‘æœç´¢

##### ç½‘é¡µæŠ“å–

##### ç»ˆç«¯æ“ä½œ

##### èµ„æºä¸‹è½½

##### PDF ç”Ÿæˆ

#### å·¥å…·è¿›é˜¶çŸ¥è¯†ï¼ˆåŸç†å’Œé«˜çº§ç‰¹æ€§ï¼‰

## MCP

### MCP æ¦‚å¿µ

### ä½¿ç”¨ MCPï¼ˆ3 ç§æ–¹å¼ï¼‰

### Spring AI MCP å¼€å‘æ¨¡å¼

### Spring AI MCP å¼€å‘å®æˆ˜ - å›¾ç‰‡æœç´¢ MCP

### MCP å¼€å‘æœ€ä½³å®è·µ

### éƒ¨ç½² MCP

### MCP å®‰å…¨é—®é¢˜

## AI æ™ºèƒ½ä½“æ„å»º

### AI æ™ºèƒ½ä½“æ¦‚å¿µ

### æ™ºèƒ½ä½“å®ç°å…³é”®

### ä½¿ç”¨ AI æ™ºèƒ½ä½“ï¼ˆ2 ç§æ–¹å¼ï¼‰

### è‡ªä¸»è§„åˆ’æ™ºèƒ½ä½“ä»‹ç»

### OpenManus å®ç°åŸç†

### è‡ªä¸»å®ç° Manus æ™ºèƒ½ä½“

### æ™ºèƒ½ä½“å·¥ä½œæµ

## AI æœåŠ¡åŒ–

### AI åº”ç”¨æ¥å£å¼€å‘ï¼ˆSSEï¼‰

### AI æ™ºèƒ½ä½“æ¥å£å¼€å‘

### AI ç”Ÿæˆå‰ç«¯ä»£ç 

### AI æœåŠ¡ Serverless éƒ¨